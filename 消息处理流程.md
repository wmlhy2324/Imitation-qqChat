# Easy Chat æ¶ˆæ¯å¤„ç†æµç¨‹è¯¦è§£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†Easy Chatç³»ç»Ÿä¸­ä»ç”¨æˆ·å‘é€æ¶ˆæ¯åˆ°æ¥æ”¶è€…æ”¶åˆ°æ¶ˆæ¯çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬WebSocketè¿æ¥å¤„ç†ã€æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†ã€ä»¥åŠä¸¤è€…ä¹‹é—´çš„å…³ç³»ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶
- **WebSocketæœåŠ¡å™¨** (`apps/im/ws`): å¤„ç†å®æ—¶è¿æ¥å’Œæ¶ˆæ¯åˆ†å‘
- **Task MQæœåŠ¡** (`apps/task/mq`): æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†å’ŒæŒä¹…åŒ–
- **Kafka**: æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶
- **MongoDB**: èŠå¤©è®°å½•å­˜å‚¨
- **Redis**: æœåŠ¡å‘ç°å’Œç¼“å­˜

### ä¸¤ç§WebSocketè¿æ¥
1. **ç”¨æˆ·è¿æ¥**: æµè§ˆå™¨/ç§»åŠ¨ç«¯ â†” WebSocketæœåŠ¡å™¨
2. **ç³»ç»Ÿè¿æ¥**: Task MQæœåŠ¡ â†” WebSocketæœåŠ¡å™¨ï¼ˆä½œä¸ºå®¢æˆ·ç«¯ï¼‰

## ğŸš€ ç³»ç»Ÿåˆå§‹åŒ–é˜¶æ®µ

### 1.1 WebSocketæœåŠ¡å™¨å¯åŠ¨
```go
// apps/im/ws/im.go
func main() {
    srv := websocket.NewServer(c.ListenOn, opts...)
    srv.Start()  // è§¦å‘server.goä¸­çš„Start()å‡½æ•°
}

// apps/im/ws/websocket/server.go  
func (s *Server) Start() {
    http.HandleFunc(s.patten, s.ServerWs)  // æ³¨å†Œè·¯ç”± "/ws"
    http.ListenAndServe(s.addr, nil)      // ç›‘å¬ :10090
}
```

**è§¦å‘æ—¶æœº**: æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œæ³¨å†ŒWebSocketè·¯ç”±å¹¶å¼€å§‹ç›‘å¬ç«¯å£

### 1.2 Task MQæœåŠ¡å¯åŠ¨
```go
// apps/task/mq/task.go
func main() {
    Run(c)  // å¯åŠ¨Task MQæœåŠ¡
}

// apps/task/mq/internal/svc/servicecontext.go
func NewServiceContext(c config.Config) *ServiceContext {
    // Task MQ ä½œä¸º WebSocket å®¢æˆ·ç«¯è¿æ¥åˆ° WebSocket æœåŠ¡å™¨
    svc.WsClient = websocket.NewClient("127.0.0.1:10090",
        websocket.WithClientHeader(header),
        websocket.WithClientDiscover(redisDiscover),
    )
}
```

**è§¦å‘æ—¶æœº**: Task MQæœåŠ¡å¯åŠ¨æ—¶ï¼Œå»ºç«‹åˆ°WebSocketæœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥

### 1.3 åˆå§‹çŠ¶æ€
```
- WebSocketæœåŠ¡å™¨ç›‘å¬ :10090ï¼Œç­‰å¾…è¿æ¥
- Task MQä½œä¸ºWebSocketå®¢æˆ·ç«¯ï¼Œè¿æ¥åˆ°WebSocketæœåŠ¡å™¨
- Kafkaç­‰å¾…æ¶ˆæ¯
- MongoDBç­‰å¾…æ•°æ®å†™å…¥
```

## ğŸ”Œ ç”¨æˆ·è¿æ¥é˜¶æ®µ

### 2.1 ç”¨æˆ·è¿æ¥è§¦å‘
```javascript
// ç”¨æˆ·æµè§ˆå™¨
const websocket = new WebSocket('ws://localhost:10090/ws');
```

### 2.2 WebSocketæœåŠ¡å™¨å¤„ç†è¿æ¥
```go
// è§¦å‘ ServerWs() å‡½æ•°
func (s *Server) ServerWs(w http.ResponseWriter, r *http.Request) {
    // 1. åˆ›å»ºWebSocketè¿æ¥
    conn := NewConn(s, w, r)
    if conn == nil {
        return
    }
    
    // 2. èº«ä»½éªŒè¯
    if !s.authentication.Auth(w, r) {
        conn.Close()
        return
    }
    
    // 3. è®°å½•è¿æ¥æ˜ å°„
    s.addConn(conn, r)
    
    // 4. å¯åŠ¨è¿æ¥å¤„ç†å™¨
    go s.handlerConn(conn)
}
```

### 2.3 è¿æ¥å¤„ç†å™¨å¯åŠ¨
```go
func (s *Server) handlerConn(conn *Conn) {
    // 1. è®¾ç½®ç”¨æˆ·ID
    uids := s.GetUsers(conn)
    conn.Uid = uids[0]
    
    // 2. æœåŠ¡å‘ç°æ³¨å†Œï¼ˆRedisä¸­è®°å½•ç”¨æˆ·-æœåŠ¡å™¨æ˜ å°„ï¼‰
    s.discover.BoundUser(conn.Uid)  // Redis: userA_id â†’ 127.0.0.1:10090
    
    // 3. å¯åŠ¨æ¶ˆæ¯å¤„ç†å™¨
    go s.handlerWrite(conn)
    
    // 4. å¯åŠ¨ç¡®è®¤å¤„ç†å™¨ï¼ˆå¯é€‰ï¼‰
    if s.isAck(nil) {
        go s.readAck(conn)
    }
    
    // 5. ä¸»å¾ªç¯ï¼šç­‰å¾…ç”¨æˆ·æ¶ˆæ¯
    for {
        _, msg, err := conn.ReadMessage()  // é˜»å¡ç­‰å¾…
        if err != nil {
            s.Close(conn)
            return
        }
        
        // è§£æå¹¶åˆ†å‘æ¶ˆæ¯
        var message Message
        json.Unmarshal(msg, &message)
        
        if s.isAck(&message) {
            conn.appendMsgMq(&message)
        } else {
            conn.message <- &message  // å‘é€åˆ°å¤„ç†é€šé“
        }
    }
}
```

### 2.4 æ¶ˆæ¯å¤„ç†å™¨å¯åŠ¨
```go
func (s *Server) handlerWrite(conn *Conn) {
    for {
        select {
        case <-conn.done:
            return  // è¿æ¥å…³é—­
            
        case message := <-conn.message:  // ç­‰å¾…æ¶ˆæ¯
            switch message.FrameType {
            case FramePing:
                s.Send(&Message{FrameType: FramePing}, conn)
            case FrameData:
                // è·¯ç”±åˆ†å‘
                if handler, ok := s.routes[message.Method]; ok {
                    handler(s, conn, message)  // è°ƒç”¨ä¸šåŠ¡å¤„ç†å™¨
                }
            }
        }
    }
}
```

## ğŸ“¨ æ¶ˆæ¯å‘é€å’Œå¤„ç†é˜¶æ®µ

### 3.1 ç”¨æˆ·å‘é€æ¶ˆæ¯
```javascript
// ç”¨æˆ·Açš„æµè§ˆå™¨
websocketA.send(JSON.stringify({
    frameType: 0,
    id: 'msg_123',
    method: 'conversation.chat',
    formId: 'userA_id',
    data: {
        chatType: 2,                    // å•èŠ
        recvId: 'userB_id',
        conversationId: 'userA_id_userB_id',
        msg: { mType: 0, content: 'Hello!' }
    }
}));
```

### 3.2 WebSocketæœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯ï¼ˆåŒæ­¥å¤„ç†ï¼‰
```go
// å¯¹äºåŒä¸€æ¡æ¶ˆæ¯ï¼Œä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œï¼š

// æ­¥éª¤1: handlerConnæ¥æ”¶æ¶ˆæ¯
_, msg, err := conn.ReadMessage()         // æ¥æ”¶WebSocketæ•°æ®
var message Message
json.Unmarshal(msg, &message)           // è§£æJSON
conn.message <- &message                // æ”¾å…¥é€šé“

// æ­¥éª¤2: handlerWriteå¤„ç†æ¶ˆæ¯  
message := <-conn.message               // ä»é€šé“å–å‡º
handler(s, conn, message)              // è°ƒç”¨Chatå¤„ç†å™¨
```

### 3.3 èŠå¤©å¤„ç†å™¨å¤„ç†
```go
// apps/im/ws/internal/handler/conversation/conersation.go
func Chat(svc *svc.ServiceContext) websocket.HandlerFunc {
    return func(srv *websocket.Server, conn *websocket.Conn, msg *websocket.Message) {
        // 1. è§£ææ¶ˆæ¯æ•°æ®
        var data ws.Chat
        mapstructure.Decode(msg.Data, &data)
        
        // 2. ç”Ÿæˆä¼šè¯IDï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
        if data.ConversationId == "" {
            switch data.ChatType {
            case constants.SingleChatType:
                data.ConversationId = wuid.CombineId(conn.Uid, data.RecvId)
            case constants.GroupChatType:
                data.ConversationId = data.RecvId
            }
        }
        
        // 3. æ¨é€åˆ°Kafkaæ¶ˆæ¯é˜Ÿåˆ—
        err := svc.MsgChatTransferClient.Push(&mq.MsgChatTransfer{
            ConversationId: data.ConversationId,
            ChatType:       data.ChatType,
            SendId:         conn.Uid,           // userA_id
            RecvId:         data.RecvId,        // userB_id
            SendTime:       time.Now().UnixMilli(),
            MType:          data.Msg.MType,
            Content:        data.Msg.Content,   // "Hello!"
            MsgId:          msg.Id,
        })
        
        if err != nil {
            srv.Send(websocket.NewErrMessage(err), conn)
        }
    }
}
```

## ğŸ”„ æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†é˜¶æ®µ

### 4.1 Task MQæ¶ˆè´¹Kafkaæ¶ˆæ¯
```go
// apps/task/mq/internal/handler/msgTransfer/msgChatTrasnfer.go
func (m *MsgChatTransfer) Consume(key, value string) error {
    fmt.Println("key : ", key, " value : ", value)
    
    var (
        data  mq.MsgChatTransfer
        ctx   = context.Background()
        msgId = primitive.NewObjectID()
    )
    
    // 1. ååºåˆ—åŒ–Kafkaæ¶ˆæ¯
    if err := json.Unmarshal([]byte(value), &data); err != nil {
        return err
    }
    
    // 2. ä¿å­˜èŠå¤©è®°å½•åˆ°MongoDB
    if err := m.addChatLog(ctx, msgId, &data); err != nil {
        return err
    }
    
    // 3. æ¨é€æ¶ˆæ¯ç»™ç›®æ ‡ç”¨æˆ·
    return m.Transfer(ctx, &ws.Push{
        ConversationId: data.ConversationId,
        ChatType:       data.ChatType,
        SendId:         data.SendId,
        RecvId:         data.RecvId,
        RecvIds:        data.RecvIds,
        SendTime:       data.SendTime,
        MType:          data.MType,
        MsgId:          msgId.Hex(),
        Content:        data.Content,
    })
}
```

### 4.2 ä¿å­˜èŠå¤©è®°å½•
```go
func (m *MsgChatTransfer) addChatLog(ctx context.Context, msgId primitive.ObjectID, data *mq.MsgChatTransfer) error {
    // æ„é€ èŠå¤©è®°å½•
    chatLog := immodels.ChatLog{
        ID:             msgId,
        ConversationId: data.ConversationId,
        SendId:         data.SendId,
        RecvId:         data.RecvId,
        ChatType:       data.ChatType,
        MsgFrom:        0,
        MsgType:        data.MType,
        MsgContent:     data.Content,
        SendTime:       data.SendTime,
    }
    
    // è®¾ç½®å·²è¯»è®°å½•ï¼ˆå‘é€è€…é»˜è®¤å·²è¯»ï¼‰
    readRecords := bitmap.NewBitmap(0)
    readRecords.Set(chatLog.SendId)
    chatLog.ReadRecords = readRecords.Export()
    
    // 1. æ’å…¥èŠå¤©è®°å½•åˆ°MongoDB
    err := m.svcCtx.ChatLogModel.Insert(ctx, &chatLog)
    if err != nil {
        return err
    }
    
    // 2. æ›´æ–°ä¼šè¯æœ€æ–°æ¶ˆæ¯
    return m.svcCtx.ConversationModel.UpdateMsg(ctx, &chatLog)
}
```

### 4.3 æ¶ˆæ¯è½¬å‘å¤„ç†
```go
// apps/task/mq/internal/handler/msgTransfer/msgTransfer.go
func (m *baseMsgTransfer) Transfer(ctx context.Context, data *ws.Push) error {
    switch data.ChatType {
    case constants.GroupChatType:
        return m.group(ctx, data)      // ç¾¤èŠå¤„ç†
    case constants.SingleChatType:
        return m.single(ctx, data)     // å•èŠå¤„ç†
    }
    return nil
}

// å•èŠå¤„ç†
func (m *baseMsgTransfer) single(ctx context.Context, data *ws.Push) error {
    // Task MQé€šè¿‡WebSocketå®¢æˆ·ç«¯å‘é€pushè¯·æ±‚åˆ°WebSocketæœåŠ¡å™¨
    return m.svcCtx.WsClient.Send(websocket.Message{
        FrameType: websocket.FrameData,
        Method:    "push",                    // è°ƒç”¨pushå¤„ç†å™¨
        FormId:    constants.SYSTEM_ROOT_UID, // ç³»ç»Ÿå‘é€
        Data:      data,                      // æ¶ˆæ¯æ•°æ®
    })
}

// ç¾¤èŠå¤„ç†
func (m *baseMsgTransfer) group(ctx context.Context, data *ws.Push) error {
    // 1. æŸ¥è¯¢ç¾¤ç»„æ‰€æœ‰æˆå‘˜
    users, err := m.svcCtx.Social.GroupUsers(ctx, &socialclient.GroupUsersReq{
        GroupId: data.RecvId,
    })
    if err != nil {
        return err
    }
    
    // 2. æ„é€ æ¥æ”¶è€…åˆ—è¡¨ï¼ˆæ’é™¤å‘é€è€…ï¼‰
    data.RecvIds = make([]string, 0, len(users.List))
    for _, members := range users.List {
        if members.UserId == data.SendId {
            continue  // ä¸ç»™è‡ªå·±å‘é€
        }
        data.RecvIds = append(data.RecvIds, members.UserId)
    }
    
    // 3. æ‰¹é‡æ¨é€
    return m.svcCtx.WsClient.Send(websocket.Message{
        FrameType: websocket.FrameData,
        Method:    "push",
        FormId:    constants.SYSTEM_ROOT_UID,
        Data:      data,
    })
}
```

## ğŸ“± æ¶ˆæ¯æ¨é€é˜¶æ®µ

### 5.1 WebSocketæœåŠ¡å™¨å¤„ç†Pushè¯·æ±‚
```go
// apps/im/ws/internal/handler/push/push.go
func Push(svc *svc.ServiceContext) websocket.HandlerFunc {
    return func(srv *websocket.Server, conn *websocket.Conn, msg *websocket.Message) {
        var data ws.Push
        if err := mapstructure.Decode(msg.Data, &data); err != nil {
            srv.Send(websocket.NewErrMessage(err))
            return
        }
        
        // æ ¹æ®èŠå¤©ç±»å‹åˆ†å‘
        switch data.ChatType {
        case constants.SingleChatType:
            single(srv, &data, data.RecvId)  // æ¨é€ç»™å•ä¸ªç”¨æˆ·
        case constants.GroupChatType:
            group(srv, &data)                // æ¨é€ç»™ç¾¤ç»„æˆå‘˜
        }
    }
}
```

### 5.2 å•èŠæ¶ˆæ¯æ¨é€
```go
func single(srv *websocket.Server, data *ws.Push, recvId string) error {
    // 1. æŸ¥æ‰¾ç›®æ ‡ç”¨æˆ·çš„WebSocketè¿æ¥
    rconn := srv.GetConn(recvId)  // è·å–userB_idçš„è¿æ¥
    if rconn == nil {
        // ç”¨æˆ·ç¦»çº¿ï¼Œæ— æ³•æ¨é€ï¼ˆå¯ä»¥å®ç°ç¦»çº¿æ¶ˆæ¯å­˜å‚¨ï¼‰
        return nil
    }
    
    srv.Infof("push msg %v", data)
    
    // 2. æ„é€ æ¨é€æ¶ˆæ¯
    return srv.Send(websocket.NewMessage(data.SendId, &ws.Chat{
        ConversationId: data.ConversationId,
        ChatType:       data.ChatType,
        SendTime:       data.SendTime,
        Msg: ws.Msg{
            ReadRecords: data.ReadRecords,
            MsgId:       data.MsgId,
            MType:       data.MType,
            Content:     data.Content,
        },
    }), rconn)  // å‘é€ç»™ç”¨æˆ·Bçš„WebSocketè¿æ¥
}
```

### 5.3 ç¾¤èŠæ¶ˆæ¯æ¨é€
```go
func group(srv *websocket.Server, data *ws.Push) error {
    // å¼‚æ­¥æ¨é€ç»™æ‰€æœ‰ç¾¤æˆå‘˜
    for _, id := range data.RecvIds {
        func(id string) {
            srv.Schedule(func() {        // å¼‚æ­¥æ‰§è¡Œ
                single(srv, data, id)    // è°ƒç”¨å•èŠæ¨é€é€»è¾‘
            })
        }(id)
    }
    return nil
}
```

## ğŸ“± å®¢æˆ·ç«¯æ¥æ”¶é˜¶æ®µ

### 6.1 ç”¨æˆ·Bæ¥æ”¶æ¶ˆæ¯
```javascript
// ç”¨æˆ·Bçš„æµè§ˆå™¨
websocketB.onmessage = function(event) {
    const message = JSON.parse(event.data);
    
    // æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ ¼å¼ï¼š
    // {
    //   "frameType": 0,
    //   "formId": "userA_id",          // å‘é€è€…ID
    //   "data": {
    //     "conversationId": "userA_id_userB_id",
    //     "chatType": 2,               // å•èŠ
    //     "sendTime": 1640995200000,
    //     "msg": {
    //       "msgId": "507f1f77bcf86cd799439011",
    //       "mType": 0,                // æ–‡æœ¬æ¶ˆæ¯
    //       "content": "Hello!"        // æ¶ˆæ¯å†…å®¹
    //     }
    //   }
    // }
    
    if (message.frameType === 0 && message.data.conversationId) {
        const chatData = message.data;
        
        // 1. æ›´æ–°èŠå¤©ç•Œé¢
        addMessageToUI({
            senderId: message.formId,
            content: chatData.msg.content,
            sendTime: chatData.sendTime,
            conversationId: chatData.conversationId
        });
        
        // 2. æ›´æ–°ä¼šè¯åˆ—è¡¨
        updateConversationList(chatData.conversationId, {
            lastMessage: chatData.msg.content,
            lastTime: chatData.sendTime
        });
        
        // 3. æ’­æ”¾æç¤ºéŸ³
        if (currentConversationId !== chatData.conversationId) {
            playNotificationSound();
        }
        
        // 4. æ›´æ–°æœªè¯»æ•°é‡
        updateUnreadCount(chatData.conversationId);
    }
};
```

## ğŸ¯ å®Œæ•´æ—¶åºå›¾

```
ç”¨æˆ·Aæµè§ˆå™¨    WebSocketæœåŠ¡å™¨    Kafkaé˜Ÿåˆ—    Task MQæœåŠ¡    MongoDB    Redis    ç”¨æˆ·Bæµè§ˆå™¨
     |              |              |           |             |         |           |
 1.  |â”€è¿æ¥è¯·æ±‚â”€â”€â”€â”€â†’  |              |           |             |         |           |
 2.  |              |â”€å»ºç«‹connAâ”€â”€â”€â†’  |           |             |         |â†â”€ç”¨æˆ·æ˜ å°„â”€  |
 3.  |              |              |           |â”€è¿æ¥WSâ”€â”€â”€â”€â”€â†’ |         |           |
 4.  |              |              |           |             |         |           |â”€è¿æ¥è¯·æ±‚â†’
 5.  |              |              |           |             |         |â†â”€ç”¨æˆ·æ˜ å°„â”€  |â†â”€å»ºç«‹connBâ”€
 6.  |              |              |           |             |         |           |
 7.  |â”€å‘é€æ¶ˆæ¯â”€â”€â”€â”€â†’  |              |           |             |         |           |
 8.  |              |â”€Chatå¤„ç†â”€â”€â”€â”€â†’  |           |             |         |           |
 9.  |              |â”€æ¨é€Kafkaâ”€â”€â”€â†’  |           |             |         |           |
10.  |              |              |â†â”€æ¶ˆè´¹æ¶ˆæ¯â”€â”€ |             |         |           |
11.  |              |              |           |â”€ä¿å­˜è®°å½•â”€â”€â”€â†’ |         |           |
12.  |              |              |           |â”€æ›´æ–°ä¼šè¯â”€â”€â”€â†’ |         |           |
13.  |              |â†â”€å‘é€pushâ”€â”€â”€â”€  |           |             |         |           |
14.  |              |â”€pushå¤„ç†â”€â”€â”€â”€â†’  |           |             |         |           |
15.  |              |â”€æŸ¥æ‰¾connBâ”€â”€â”€â†’  |           |             |         |           |
16.  |              |â”€æ¨é€æ¶ˆæ¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ |           |
17.  |              |              |           |             |         |           |â†â”€æ˜¾ç¤ºæ¶ˆæ¯â”€
```

## ğŸ”„ å…³é”®è§¦å‘æœºåˆ¶æ€»ç»“

### WebSocketè¿æ¥å¤„ç†è§¦å‘æ—¶æœº
1. **ServerWs()**: å®¢æˆ·ç«¯å‘èµ·WebSocketè¿æ¥æ—¶
2. **handlerConn()**: è¿æ¥å»ºç«‹åç«‹å³å¯åŠ¨
3. **handlerWrite()**: è¿æ¥å»ºç«‹åç«‹å³å¯åŠ¨ï¼Œç­‰å¾…æ¶ˆæ¯
4. **addConn()**: èº«ä»½éªŒè¯é€šè¿‡åç«‹å³æ‰§è¡Œ
5. **Close()**: è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨è§¦å‘

### æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†è§¦å‘æ—¶æœº
1. **Chatå¤„ç†å™¨**: ç”¨æˆ·å‘é€èŠå¤©æ¶ˆæ¯æ—¶
2. **Kafka Push**: Chatå¤„ç†å™¨æ‰§è¡Œæ—¶
3. **MQ Consume**: Kafkaæœ‰æ–°æ¶ˆæ¯æ—¶
4. **MongoDB Insert**: MQæ¶ˆè´¹æ¶ˆæ¯æ—¶
5. **Pushè¯·æ±‚**: MQå¤„ç†å®Œå­˜å‚¨å

### æ‰§è¡Œé¡ºåºç‰¹ç‚¹
- **åŒä¸€æ¡æ¶ˆæ¯**: ä¸¥æ ¼æŒ‰é¡ºåºå¤„ç†ï¼ˆæ¥æ”¶â†’è§£æâ†’å¤„ç†â†’æ¨é€ï¼‰
- **ä¸åŒæ¶ˆæ¯**: å¯ä»¥å¹¶å‘å¤„ç†ï¼ˆé€šè¿‡goroutineå’Œé€šé“ï¼‰
- **å¼‚æ­¥è§£è€¦**: é€šè¿‡Kafkaå®ç°å‘é€å’Œæ¥æ”¶çš„å¼‚æ­¥å¤„ç†
- **åˆ†å¸ƒå¼æ”¯æŒ**: é€šè¿‡RedisæœåŠ¡å‘ç°æ”¯æŒå¤šæœåŠ¡å™¨éƒ¨ç½²

## ğŸ¯ æ€§èƒ½ç‰¹ç‚¹

### ä¼˜åŠ¿
1. **å¼‚æ­¥å¤„ç†**: æ¶ˆæ¯å‘é€åç«‹å³è¿”å›ï¼Œä¸é˜»å¡ç”¨æˆ·
2. **å¯é æ€§**: æ¶ˆæ¯å…ˆä¿å­˜åˆ°MongoDBå†æ¨é€
3. **å¯æ‰©å±•**: æ”¯æŒå¤šWebSocketæœåŠ¡å™¨é›†ç¾¤
4. **é¡ºåºä¿è¯**: é€šè¿‡æ—¶é—´æˆ³å’Œé˜Ÿåˆ—ä¿è¯æ¶ˆæ¯é¡ºåº

### æ³¨æ„äº‹é¡¹
1. **é€šé“ç¼“å†²**: æ¯ä¸ªè¿æ¥çš„æ¶ˆæ¯é€šé“ç¼“å†²åŒºä¸º1ï¼Œé«˜é¢‘æ¶ˆæ¯å¯èƒ½é˜»å¡
2. **ç¦»çº¿ç”¨æˆ·**: ç¦»çº¿ç”¨æˆ·æ¶ˆæ¯å·²ä¿å­˜ï¼Œä½†éœ€è¦é¢å¤–çš„ç¦»çº¿æ¨é€æœºåˆ¶
3. **ç½‘ç»œå»¶è¿Ÿ**: è·¨æœåŠ¡å™¨æ¶ˆæ¯è½¬å‘ä¼šå¢åŠ å»¶è¿Ÿ
4. **æ•…éšœæ¢å¤**: éœ€è¦è€ƒè™‘å„ç»„ä»¶æ•…éšœæ—¶çš„æ¶ˆæ¯å¤„ç†æœºåˆ¶

---

*æœ¬æ–‡æ¡£æè¿°äº†Easy Chatç³»ç»Ÿçš„å®Œæ•´æ¶ˆæ¯å¤„ç†æµç¨‹ï¼Œæ¶µç›–äº†ä»ç”¨æˆ·å‘é€æ¶ˆæ¯åˆ°æ¥æ”¶è€…æ”¶åˆ°æ¶ˆæ¯çš„æ¯ä¸ªç¯èŠ‚ã€‚*
